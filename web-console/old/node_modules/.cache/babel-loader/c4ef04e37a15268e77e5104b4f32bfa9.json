{"ast":null,"code":"import _classCallCheck from\"/react/cutlery/web-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/react/cutlery/web-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/react/cutlery/web-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/react/cutlery/web-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/react/cutlery/web-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _slicedToArray from\"/react/cutlery/web-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import Button from'@material-ui/core/Button';import{RadioGroup,FormControlLabel,Radio}from'@material-ui/core';import List from'@material-ui/core/List';import ListItem from'@material-ui/core/ListItem';import ListItemText from'@material-ui/core/ListItemText';import Divider from'@material-ui/core/Divider';import{withRouter}from'react-router';import{Dialog,DialogTitle,DialogContent,DialogActions}from'@material-ui/core';import TextField from'@material-ui/core/TextField';//import signalWifi4Bar from '@material-ui/icons/signalWifi4Bar';\nimport{SignalWifi4Bar,SignalWifi3Bar,SignalWifi2Bar,SignalWifi1Bar,SignalWifi0Bar}from'@material-ui/icons';import CircularProgress from'@material-ui/core/CircularProgress';import mqtt from'mqtt';function ShowReconnectMessage(props){var target_ssid=props.target_ssid,open=props.open;return React.createElement(Dialog,{fullScreen:true,open:open},React.createElement(\"h2\",null,\"wifi\\u3078\\u306E\\u63A5\\u7D9A\\u3092\\u958B\\u59CB\\u3057\\u307E\\u3059\"),React.createElement(\"ul\",null,React.createElement(\"li\",null,\"dish\\u3068\\u306E\\u63A5\\u7D9A\\u3092\\u5207\\u65AD\\u3057\\u307E\\u3059\\u3002\"),React.createElement(\"li\",null,\"\\u30B9\\u30DE\\u30FC\\u30C8\\u30D5\\u30A9\\u30F3\\u3092\",target_ssid,\"\\u306B\\u63A5\\u7D9A\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\\u3002\"),React.createElement(\"li\",null,\"\\uFF13\\uFF10\\u79D2\\u5F8C\\u306B\\u81EA\\u52D5\\u7684\\u306Bcutlery\\u3092\\u518D\\u8AAD\\u307F\\u8FBC\\u307F\\u3057\\u307E\\u3059\\u3002\")));}function WifiStrengthIcon(props){var strength=props.strength;if(strength>=4){return React.createElement(SignalWifi4Bar,null);}else if(strength===3){return React.createElement(SignalWifi3Bar,null);}else if(strength===2){return React.createElement(SignalWifi2Bar,null);}else if(strength===1){return React.createElement(SignalWifi1Bar,null);}else{return React.createElement(SignalWifi0Bar,null);}}function PasswordDialog(props){var onClose=props.onClose,onSubmit=props.onSubmit,open=props.open,title=props.title;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),passwordText=_useState2[0],setPassword=_useState2[1];function handleClose(){onClose();}function submit(){onSubmit(passwordText);}function onChange(event){setPassword(event.target.value);}return React.createElement(Dialog,{onClose:handleClose,\"aria-labelledby\":\"simple-dialog-title\",open:open},React.createElement(DialogTitle,{id:\"simple-dialog-title\"},title),React.createElement(DialogContent,null,React.createElement(TextField,{autoFocus:true,margin:\"dense\",id:\"ssid_password\",label:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\\u3092\\u5165\\u529B\",type:\"password\",onChange:onChange,fullWidth:true})),React.createElement(DialogActions,null,React.createElement(Button,{onClick:submit,color:\"primary\"},\"\\u63A5\\u7D9A\"),React.createElement(Button,{onClick:handleClose,color:\"default\"},\"\\u623B\\u308B\")));}function getUrl(){var host_name=window.location.host.split(':')[0];var url=\"ws://\"+host_name+\":9090\";//console.log(url);\n//url=\"ws://dishdev02.local:9090\";\nurl=\"ws://192.168.3.147:9090\";//this.mqtt_client = mqtt.connect(url);\nreturn url;}var WifiList=/*#__PURE__*/function(_React$Component){_inherits(WifiList,_React$Component);function WifiList(props){var _this;_classCallCheck(this,WifiList);_this=_possibleConstructorReturn(this,_getPrototypeOf(WifiList).call(this,props));_this.openPassword=function(ssid){_this.setState({passwordDialogOpen:true,selected_ssid:ssid});};_this.passwordClose=function(){_this.setState({passwordDialogOpen:false});};_this.onPasswordSubmitted=function(password){_this.setState({passwordText:password});_this.setState({reconnectDialogOpen:true});var config_value={\"ssid\":_this.state.selected_ssid,\"password\":password};_this.mqtt_client.publish('wifi_config/config',JSON.stringify(config_value));_this.passwordClose();};_this.refresh_ssid_list=function(topic,message){//console.log(message.toString())\nconsole.log(\"refreshing\");var obj=JSON.parse(message.toString());//this.setState({ssid_list:this.state.ssid_list.concat(obj)});\n//this.setState({ssid_list:this.state.ssid_list = obj});\n_this.setState({ssid_list:obj});};_this.state={ssid_list:[{id:\"test\",name:\"test\",strength:70}],passwordDialogOpen:false,reconnectDialogOpen:false,passwordText:\"\",selected_ssid:\"\",switch_value:\"ap\"};_this.mqtt_connect=null;_this.mqtt_client=null;return _this;}_createClass(WifiList,[{key:\"connect_mqtt_server\",value:function connect_mqtt_server(){var url=getUrl();//console.log(url);\nurl=\"ws://dishdev02.local:9090\";this.mqtt_client=mqtt.connect(url);//#this.wireless_switch=mqtt.connect(url);\nthis.mqtt_client.on('connect',function(){console.log(\"connected.\");});//this.mqtt_client.subscribe('wireless_switch/get_status',{qos:2});\nthis.mqtt_client.subscribe('wifi_config/scan_results',{qos:0});this.mqtt_client.publish('process_waker/wake','wifi_config',{qos:2});this.mqtt_client.on(\"message\",this.refresh_ssid_list);}},{key:\"render\",value:function render(){var _this2=this;return React.createElement(\"div\",null,React.createElement(\"h3\",null,\"\\u63A5\\u7D9A\\u53EF\\u80FD\\u306AWifi\\u30EA\\u30B9\\u30C8\"),React.createElement(List,{component:\"nav\"},this.state.ssid_list.map(function(wifi){return React.createElement(ListItem,{key:wifi.id,onClick:function onClick(){return _this2.openPassword(wifi.name);}},React.createElement(ListItemText,{primary:wifi.name.substr(0,20)}),React.createElement(WifiStrengthIcon,{strength:wifi.strength}));}),this.state.ssid_list.length<1&&React.createElement(ListItem,{key:\"0\"},React.createElement(ListItemText,{primary:\"\\u8AAD\\u8FBC\\u4E2D\"}),React.createElement(CircularProgress,null))),React.createElement(Divider,null),React.createElement(List,{component:\"nav\",\"aria-label\":\"secondary mailbox folders\"},React.createElement(ListItem,{button:true},React.createElement(ListItemText,{primary:\"\\u305D\\u306E\\u4ED6\"}))),React.createElement(PasswordDialog,{title:this.state.selected_ssid.substr(0,20),open:this.state.passwordDialogOpen,onClose:this.passwordClose,onSubmit:this.onPasswordSubmitted}),React.createElement(ShowReconnectMessage,{open:this.state.reconnectDialogOpen,target_ssid:this.state.selected_ssid}));}}]);return WifiList;}(React.Component);var WifiConfig=/*#__PURE__*/function(_React$Component2){_inherits(WifiConfig,_React$Component2);function WifiConfig(props){var _this3;_classCallCheck(this,WifiConfig);_this3=_possibleConstructorReturn(this,_getPrototypeOf(WifiConfig).call(this,props));_this3.backToHome=function(){_this3.props.history.push('/');};_this3.changeSwitchValue=function(value){_this3.setState({switch_value:value});};_this3.state={ssid_list:[],passwordDialogOpen:false,reconnectDialogOpen:false,passwordText:\"\",selected_ssid:\"\",switch_value:\"ap\"};_this3.mqtt_connect=null;_this3.mqtt_client=null;return _this3;}_createClass(WifiConfig,[{key:\"componentWillMount\",value:function componentWillMount(){//connect to MQTT\n//alert(localtion.host);\n//var host_name=window.location.host.split(':')[0];\n//var url=\"ws://\"+host_name+\":9090\";\n}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){//console.log(\"disconnecting...\");\n//this.mqtt_client.end();\n}},{key:\"render\",value:function render(){var _this4=this;return React.createElement(\"div\",null,React.createElement(\"h2\",null,\"Wifi\\u8A2D\\u5B9A\"),React.createElement(\"h3\",null,\"\\u63A5\\u7D9A\\u30E2\\u30FC\\u30C9\"),React.createElement(RadioGroup,{name:\"network-mode-selector\",value:this.state.switch_value},React.createElement(ListItem,{button:true,onClick:function onClick(){return _this4.changeSwitchValue(\"ap\");}},React.createElement(FormControlLabel,{value:\"ap\",control:React.createElement(Radio,null)}),React.createElement(ListItemText,{primary:\"AP\\u30E2\\u30FC\\u30C9\",secondary:\"\\\"dish0010\\\"\\u3068\\u3057\\u3066\\u63A5\\u7D9A\\u51FA\\u6765\\u307E\\u3059\"})),React.createElement(ListItem,{button:true,onClick:function onClick(){return _this4.changeSwitchValue(\"wifi\");}},React.createElement(FormControlLabel,{value:\"wifi\",control:React.createElement(Radio,null)}),React.createElement(ListItemText,{primary:\"Wifi\\u30E2\\u30FC\\u30C9\",secondary:\"\\u63A5\\u7D9A\\u4E2D\\uFF1APOMIQ24\"}))),this.state.switch_value===\"wifi\"?React.createElement(WifiList,null):'',React.createElement(\"hr\",null),React.createElement(Button,{variant:\"contained\",color:\"default\",onClick:this.backToHome},\"\\u623B\\u308B\"));}}]);return WifiConfig;}(React.Component);export default withRouter(WifiConfig);","map":{"version":3,"sources":["/react/cutlery/web-console/src/WifiConfig.js"],"names":["React","useState","Button","RadioGroup","FormControlLabel","Radio","List","ListItem","ListItemText","Divider","withRouter","Dialog","DialogTitle","DialogContent","DialogActions","TextField","SignalWifi4Bar","SignalWifi3Bar","SignalWifi2Bar","SignalWifi1Bar","SignalWifi0Bar","CircularProgress","mqtt","ShowReconnectMessage","props","target_ssid","open","WifiStrengthIcon","strength","PasswordDialog","onClose","onSubmit","title","passwordText","setPassword","handleClose","submit","onChange","event","target","value","getUrl","host_name","window","location","host","split","url","WifiList","openPassword","ssid","setState","passwordDialogOpen","selected_ssid","passwordClose","onPasswordSubmitted","password","reconnectDialogOpen","config_value","state","mqtt_client","publish","JSON","stringify","refresh_ssid_list","topic","message","console","log","obj","parse","toString","ssid_list","id","name","switch_value","mqtt_connect","connect","on","subscribe","qos","map","wifi","substr","length","Component","WifiConfig","backToHome","history","push","changeSwitchValue"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\n\n\nimport Button from '@material-ui/core/Button';\n\nimport {RadioGroup,FormControlLabel,Radio} from '@material-ui/core';\n\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Divider from '@material-ui/core/Divider';\nimport { withRouter } from 'react-router';\nimport { Dialog,DialogTitle,DialogContent,DialogActions } from '@material-ui/core';\nimport TextField from '@material-ui/core/TextField';\n//import signalWifi4Bar from '@material-ui/icons/signalWifi4Bar';\nimport {SignalWifi4Bar,SignalWifi3Bar,SignalWifi2Bar,SignalWifi1Bar,SignalWifi0Bar} from '@material-ui/icons';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nimport mqtt from 'mqtt';\n\n  function ShowReconnectMessage(props){\n    const {target_ssid,open} = props;\n\n    return(\n    <Dialog fullScreen open={open}>\n      <h2>wifiへの接続を開始します</h2>\n      <ul>\n        <li>dishとの接続を切断します。</li>\n        <li>スマートフォンを{target_ssid}に接続してください。</li>\n        <li>３０秒後に自動的にcutleryを再読み込みします。</li>\n      </ul>\n    </Dialog>\n    );\n  }\n\n  function WifiStrengthIcon(props){\n    const {strength} = props;\n\n    if (strength>=4){\n      return <SignalWifi4Bar />\n    }else if(strength===3){\n      return <SignalWifi3Bar />\n    }else if(strength===2){\n      return <SignalWifi2Bar />\n    }else if(strength===1){\n        return <SignalWifi1Bar />\n    }else{\n      return <SignalWifi0Bar />\n    }\n  }\n\n  function PasswordDialog(props){\n    const { onClose, onSubmit, open, title } = props;\n    const [passwordText,setPassword] = useState(0);\n\n    function handleClose() {\n      onClose();\n    }\n\n    function submit(){\n      onSubmit(passwordText);\n    }\n\n    function onChange(event){\n      setPassword(event.target.value);\n    }\n  \n    return (\n      <Dialog onClose={handleClose} aria-labelledby=\"simple-dialog-title\" open={open}>\n        <DialogTitle id=\"simple-dialog-title\">{title}</DialogTitle>\n        <DialogContent>\n          <TextField\n            autoFocus\n            margin=\"dense\"\n            id=\"ssid_password\"\n            label=\"パスワードを入力\"\n            type=\"password\"\n            onChange={onChange}\n            fullWidth\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={submit} color=\"primary\">\n            接続\n          </Button>\n          <Button onClick={handleClose} color=\"default\">\n            戻る\n          </Button>\n        </DialogActions>\n      </Dialog>\n    );\n  }\n\n  function getUrl(){\n    var host_name=window.location.host.split(':')[0];\n    var url=\"ws://\"+host_name+\":9090\";\n    //console.log(url);\n    //url=\"ws://dishdev02.local:9090\";\n    url=\"ws://192.168.3.147:9090\";\n    //this.mqtt_client = mqtt.connect(url);\n    return url;\n  }\n\n\n  class WifiList extends React.Component{\n    constructor(props){\n      super(props);\n      this.state = {\n        ssid_list:[{id:\"test\",name:\"test\",strength:70}],\n        passwordDialogOpen:false,\n        reconnectDialogOpen:false,\n        passwordText:\"\",\n        selected_ssid:\"\",\n        switch_value: \"ap\"\n      };\n      this.mqtt_connect=null;\n      this.mqtt_client=null;\n    }\n\n    openPassword = (ssid) =>{\n      this.setState({passwordDialogOpen:true,\n      selected_ssid:ssid});\n    }\n\n    passwordClose = () => {\n      this.setState({passwordDialogOpen:false});\n    }\n\n    onPasswordSubmitted = (password) => {\n      this.setState({passwordText:password});\n      this.setState({reconnectDialogOpen:true});\n      var config_value={\"ssid\":this.state.selected_ssid,\"password\":password}\n\n      this.mqtt_client.publish('wifi_config/config',JSON.stringify(config_value));\n      this.passwordClose();\n    }\n\n    refresh_ssid_list = (topic,message) => {\n      //console.log(message.toString())\n      console.log(\"refreshing\");\n      var obj=JSON.parse(message.toString());\n      //this.setState({ssid_list:this.state.ssid_list.concat(obj)});\n      //this.setState({ssid_list:this.state.ssid_list = obj});\n      this.setState({ssid_list:obj});\n    }\n\n    connect_mqtt_server(){\n      var url=getUrl();\n      //console.log(url);\n      url=\"ws://dishdev02.local:9090\";\n      this.mqtt_client = mqtt.connect(url);\n      //#this.wireless_switch=mqtt.connect(url);\n\n      this.mqtt_client.on('connect',function(){\n        console.log(\"connected.\");\n      })\n\n      //this.mqtt_client.subscribe('wireless_switch/get_status',{qos:2});\n\n      this.mqtt_client.subscribe('wifi_config/scan_results',{qos:0});\n      this.mqtt_client.publish('process_waker/wake','wifi_config',{qos:2});\n      this.mqtt_client.on(\"message\",this.refresh_ssid_list);\n    }\n\n    render(){\n      return (\n        <div>\n          <h3>接続可能なWifiリスト</h3>\n          <List component=\"nav\">\n            {this.state.ssid_list.map(wifi => (\n              <ListItem key={wifi.id} onClick={() => this.openPassword(wifi.name)}>\n                <ListItemText primary={wifi.name.substr(0,20)} />\n                <WifiStrengthIcon strength={wifi.strength} />\n              </ListItem>\n            )\n            )}\n            {this.state.ssid_list.length < 1 && <ListItem key=\"0\">\n              <ListItemText primary=\"読込中\" />\n              <CircularProgress  />\n            </ListItem>}\n          </List>\n          <Divider />\n          <List component=\"nav\" aria-label=\"secondary mailbox folders\">\n            <ListItem button>\n              <ListItemText primary=\"その他\" />\n            </ListItem>\n          </List>\n                  {/* Password Dialog */}\n        <PasswordDialog title={this.state.selected_ssid.substr(0,20)} open={this.state.passwordDialogOpen} \n        onClose={this.passwordClose} onSubmit={this.onPasswordSubmitted}></PasswordDialog>\n        {/* Explain */ }\n        <ShowReconnectMessage open={this.state.reconnectDialogOpen} target_ssid={this.state.selected_ssid}/>\n        </div>\n    );\n    }\n  }\n\n  class WifiConfig extends React.Component {\n    constructor(props){\n      super(props);\n      this.state = {\n        ssid_list:[],\n        passwordDialogOpen:false,\n        reconnectDialogOpen:false,\n        passwordText:\"\",\n        selected_ssid:\"\",\n        switch_value: \"ap\"\n      };\n      this.mqtt_connect=null;\n      this.mqtt_client=null;\n    }\n\n    componentWillMount(){\n      //connect to MQTT\n      //alert(localtion.host);\n      //var host_name=window.location.host.split(':')[0];\n      //var url=\"ws://\"+host_name+\":9090\";\n    }\n\n    componentWillUnmount(){\n      //console.log(\"disconnecting...\");\n      //this.mqtt_client.end();\n    }\n\n    backToHome = () => {\n        this.props.history.push('/');\n    }\n\n    changeSwitchValue = (value) =>{\n      this.setState({switch_value:value});\n    }\n\n    render() {\n      return (\n        <div>\n          <h2>Wifi設定</h2>\n          {/* End hero unit */}\n              <h3>接続モード</h3>\n              <RadioGroup name=\"network-mode-selector\" value={this.state.switch_value}>\n                  <ListItem button onClick={() => this.changeSwitchValue(\"ap\")}>\n                    <FormControlLabel value=\"ap\" control={<Radio />}/>\n                    <ListItemText primary=\"APモード\" secondary='\"dish0010\"として接続出来ます' />\n                  </ListItem>\n                  <ListItem button onClick={() => this.changeSwitchValue(\"wifi\")}>\n                    <FormControlLabel value=\"wifi\" control={<Radio/>}/>\n                    <ListItemText primary=\"Wifiモード\" secondary=\"接続中：POMIQ24\"/>\n                  </ListItem>\n              </RadioGroup>\n              {this.state.switch_value===\"wifi\" ? <WifiList /> : ''}\n              <hr />\n              <Button variant=\"contained\" color=\"default\" onClick={this.backToHome}>戻る</Button>\n\n        </div>\n      );\n    }\n  }\n　　　　　　　　　　　　　　　　　　　　　　　　　　　　　\n  export default withRouter(WifiConfig);"]},"metadata":{},"sourceType":"module"}