{"ast":null,"code":"import _slicedToArray from \"/react/cutlery/web-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/react/cutlery/web-console/src/WifiConfig.js\";\nimport React, { useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport { RadioGroup, FormControlLabel, Radio } from '@material-ui/core';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Divider from '@material-ui/core/Divider';\nimport { withRouter } from 'react-router';\nimport { Dialog, DialogTitle, DialogContent, DialogActions } from '@material-ui/core';\nimport TextField from '@material-ui/core/TextField'; //import signalWifi4Bar from '@material-ui/icons/signalWifi4Bar';\n\nimport { SignalWifi4Bar, SignalWifi3Bar, SignalWifi2Bar, SignalWifi1Bar, SignalWifi0Bar } from '@material-ui/icons';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport mqtt from 'mqtt';\n\nfunction ShowReconnectMessage(props) {\n  const target_ssid = props.target_ssid,\n        open = props.open;\n  return React.createElement(Dialog, {\n    fullScreen: true,\n    open: open,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 25\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26\n    },\n    __self: this\n  }, \"wifi\\u3078\\u306E\\u63A5\\u7D9A\\u3092\\u958B\\u59CB\\u3057\\u307E\\u3059\"), React.createElement(\"ul\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 27\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 28\n    },\n    __self: this\n  }, \"dish\\u3068\\u306E\\u63A5\\u7D9A\\u3092\\u5207\\u65AD\\u3057\\u307E\\u3059\\u3002\"), React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29\n    },\n    __self: this\n  }, \"\\u30B9\\u30DE\\u30FC\\u30C8\\u30D5\\u30A9\\u30F3\\u3092\", target_ssid, \"\\u306B\\u63A5\\u7D9A\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\\u3002\"), React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 30\n    },\n    __self: this\n  }, \"\\uFF13\\uFF10\\u79D2\\u5F8C\\u306B\\u81EA\\u52D5\\u7684\\u306Bcutlery\\u3092\\u518D\\u8AAD\\u307F\\u8FBC\\u307F\\u3057\\u307E\\u3059\\u3002\")));\n}\n\nfunction WifiStrengthIcon(props) {\n  const strength = props.strength;\n\n  if (strength >= 4) {\n    return React.createElement(SignalWifi4Bar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40\n      },\n      __self: this\n    });\n  } else if (strength === 3) {\n    return React.createElement(SignalWifi3Bar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 42\n      },\n      __self: this\n    });\n  } else if (strength === 2) {\n    return React.createElement(SignalWifi2Bar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 44\n      },\n      __self: this\n    });\n  } else if (strength === 1) {\n    return React.createElement(SignalWifi1Bar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 46\n      },\n      __self: this\n    });\n  } else {\n    return React.createElement(SignalWifi0Bar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 48\n      },\n      __self: this\n    });\n  }\n}\n\nfunction PasswordDialog(props) {\n  const onClose = props.onClose,\n        onSubmit = props.onSubmit,\n        open = props.open,\n        title = props.title;\n\n  const _useState = useState(0),\n        _useState2 = _slicedToArray(_useState, 2),\n        passwordText = _useState2[0],\n        setPassword = _useState2[1];\n\n  function handleClose() {\n    onClose();\n  }\n\n  function submit() {\n    onSubmit(passwordText);\n  }\n\n  function onChange(event) {\n    setPassword(event.target.value);\n  }\n\n  return React.createElement(Dialog, {\n    onClose: handleClose,\n    \"aria-labelledby\": \"simple-dialog-title\",\n    open: open,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69\n    },\n    __self: this\n  }, React.createElement(DialogTitle, {\n    id: \"simple-dialog-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70\n    },\n    __self: this\n  }, title), React.createElement(DialogContent, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71\n    },\n    __self: this\n  }, React.createElement(TextField, {\n    autoFocus: true,\n    margin: \"dense\",\n    id: \"ssid_password\",\n    label: \"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\\u3092\\u5165\\u529B\",\n    type: \"password\",\n    onChange: onChange,\n    fullWidth: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72\n    },\n    __self: this\n  })), React.createElement(DialogActions, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  }, React.createElement(Button, {\n    onClick: submit,\n    color: \"primary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }, \"\\u63A5\\u7D9A\"), React.createElement(Button, {\n    onClick: handleClose,\n    color: \"default\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86\n    },\n    __self: this\n  }, \"\\u623B\\u308B\")));\n}\n\nfunction getUrl() {\n  var host_name = window.location.host.split(':')[0];\n  var url = \"ws://\" + host_name + \":9090\"; //console.log(url);\n  //url=\"ws://dishdev02.local:9090\";\n\n  url = \"ws://192.168.3.147:9090\"; //this.mqtt_client = mqtt.connect(url);\n\n  return url;\n}\n\nclass WifiList extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.openPassword = ssid => {\n      this.setState({\n        passwordDialogOpen: true,\n        selected_ssid: ssid\n      });\n    };\n\n    this.passwordClose = () => {\n      this.setState({\n        passwordDialogOpen: false\n      });\n    };\n\n    this.onPasswordSubmitted = password => {\n      this.setState({\n        passwordText: password\n      });\n      this.setState({\n        reconnectDialogOpen: true\n      });\n      var config_value = {\n        \"ssid\": this.state.selected_ssid,\n        \"password\": password\n      };\n      this.mqtt_client.publish('wifi_config/config', JSON.stringify(config_value));\n      this.passwordClose();\n    };\n\n    this.refresh_ssid_list = (topic, message) => {\n      //console.log(message.toString())\n      console.log(\"refreshing\");\n      var obj = JSON.parse(message.toString()); //this.setState({ssid_list:this.state.ssid_list.concat(obj)});\n      //this.setState({ssid_list:this.state.ssid_list = obj});\n\n      this.setState({\n        ssid_list: obj\n      });\n    };\n\n    this.state = {\n      ssid_list: [{\n        id: \"test\",\n        name: \"test\",\n        strength: 70\n      }],\n      passwordDialogOpen: false,\n      reconnectDialogOpen: false,\n      passwordText: \"\",\n      selected_ssid: \"\",\n      switch_value: \"ap\"\n    };\n    this.mqtt_connect = null;\n    this.mqtt_client = null;\n  }\n\n  connect_mqtt_server() {\n    var url = getUrl(); //console.log(url);\n\n    url = \"ws://dishdev02.local:9090\";\n    this.mqtt_client = mqtt.connect(url); //#this.wireless_switch=mqtt.connect(url);\n\n    this.mqtt_client.on('connect', function () {\n      console.log(\"connected.\");\n    }); //this.mqtt_client.subscribe('wireless_switch/get_status',{qos:2});\n\n    this.mqtt_client.subscribe('wifi_config/scan_results', {\n      qos: 0\n    });\n    this.mqtt_client.publish('process_waker/wake', 'wifi_config', {\n      qos: 2\n    });\n    this.mqtt_client.on(\"message\", this.refresh_ssid_list);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }, \"\\u63A5\\u7D9A\\u53EF\\u80FD\\u306AWifi\\u30EA\\u30B9\\u30C8\"), React.createElement(List, {\n      component: \"nav\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169\n      },\n      __self: this\n    }, this.state.ssid_list.map(wifi => React.createElement(ListItem, {\n      key: wifi.id,\n      onClick: () => this.openPassword(wifi.name),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, React.createElement(ListItemText, {\n      primary: wifi.name.substr(0, 20),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }), React.createElement(WifiStrengthIcon, {\n      strength: wifi.strength,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }))), this.state.ssid_list.length < 1 && React.createElement(ListItem, {\n      key: \"0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, React.createElement(ListItemText, {\n      primary: \"\\u8AAD\\u8FBC\\u4E2D\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }), React.createElement(CircularProgress, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }))), React.createElement(Divider, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }), React.createElement(List, {\n      component: \"nav\",\n      \"aria-label\": \"secondary mailbox folders\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }, React.createElement(ListItem, {\n      button: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, React.createElement(ListItemText, {\n      primary: \"\\u305D\\u306E\\u4ED6\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    }))), React.createElement(PasswordDialog, {\n      title: this.state.selected_ssid.substr(0, 20),\n      open: this.state.passwordDialogOpen,\n      onClose: this.passwordClose,\n      onSubmit: this.onPasswordSubmitted,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }), React.createElement(ShowReconnectMessage, {\n      open: this.state.reconnectDialogOpen,\n      target_ssid: this.state.selected_ssid,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }));\n  }\n\n}\n\nclass WifiConfig extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.backToHome = () => {\n      this.props.history.push('/');\n    };\n\n    this.changeSwitchValue = value => {\n      this.setState({\n        switch_value: value\n      });\n    };\n\n    this.state = {\n      ssid_list: [],\n      passwordDialogOpen: false,\n      reconnectDialogOpen: false,\n      passwordText: \"\",\n      selected_ssid: \"\",\n      switch_value: \"ap\"\n    };\n    this.mqtt_connect = null;\n    this.mqtt_client = null;\n  }\n\n  componentWillMount() {//connect to MQTT\n    //alert(localtion.host);\n    //var host_name=window.location.host.split(':')[0];\n    //var url=\"ws://\"+host_name+\":9090\";\n  }\n\n  componentWillUnmount() {//console.log(\"disconnecting...\");\n    //this.mqtt_client.end();\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, \"Wifi\\u8A2D\\u5B9A\"), React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    }, \"\\u63A5\\u7D9A\\u30E2\\u30FC\\u30C9\"), React.createElement(RadioGroup, {\n      name: \"network-mode-selector\",\n      value: this.state.switch_value,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239\n      },\n      __self: this\n    }, React.createElement(ListItem, {\n      button: true,\n      onClick: () => this.changeSwitchValue(\"ap\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, React.createElement(FormControlLabel, {\n      value: \"ap\",\n      control: React.createElement(Radio, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }), React.createElement(ListItemText, {\n      primary: \"AP\\u30E2\\u30FC\\u30C9\",\n      secondary: \"\\\"dish0010\\\"\\u3068\\u3057\\u3066\\u63A5\\u7D9A\\u51FA\\u6765\\u307E\\u3059\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    })), React.createElement(ListItem, {\n      button: true,\n      onClick: () => this.changeSwitchValue(\"wifi\"),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244\n      },\n      __self: this\n    }, React.createElement(FormControlLabel, {\n      value: \"wifi\",\n      control: React.createElement(Radio, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }), React.createElement(ListItemText, {\n      primary: \"Wifi\\u30E2\\u30FC\\u30C9\",\n      secondary: \"\\u63A5\\u7D9A\\u4E2D\\uFF1APOMIQ24\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }))), this.state.switch_value === \"wifi\" ? React.createElement(WifiList, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249\n      },\n      __self: this\n    }) : '', React.createElement(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    }), React.createElement(Button, {\n      variant: \"contained\",\n      color: \"default\",\n      onClick: this.backToHome,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251\n      },\n      __self: this\n    }, \"\\u623B\\u308B\"));\n  }\n\n}\n\nexport default withRouter(WifiConfig);","map":{"version":3,"sources":["/react/cutlery/web-console/src/WifiConfig.js"],"names":["React","useState","Button","RadioGroup","FormControlLabel","Radio","List","ListItem","ListItemText","Divider","withRouter","Dialog","DialogTitle","DialogContent","DialogActions","TextField","SignalWifi4Bar","SignalWifi3Bar","SignalWifi2Bar","SignalWifi1Bar","SignalWifi0Bar","CircularProgress","mqtt","ShowReconnectMessage","props","target_ssid","open","WifiStrengthIcon","strength","PasswordDialog","onClose","onSubmit","title","passwordText","setPassword","handleClose","submit","onChange","event","target","value","getUrl","host_name","window","location","host","split","url","WifiList","Component","constructor","openPassword","ssid","setState","passwordDialogOpen","selected_ssid","passwordClose","onPasswordSubmitted","password","reconnectDialogOpen","config_value","state","mqtt_client","publish","JSON","stringify","refresh_ssid_list","topic","message","console","log","obj","parse","toString","ssid_list","id","name","switch_value","mqtt_connect","connect_mqtt_server","connect","on","subscribe","qos","render","map","wifi","substr","length","WifiConfig","backToHome","history","push","changeSwitchValue","componentWillMount","componentWillUnmount"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\n\n\nimport Button from '@material-ui/core/Button';\n\nimport {RadioGroup,FormControlLabel,Radio} from '@material-ui/core';\n\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Divider from '@material-ui/core/Divider';\nimport { withRouter } from 'react-router';\nimport { Dialog,DialogTitle,DialogContent,DialogActions } from '@material-ui/core';\nimport TextField from '@material-ui/core/TextField';\n//import signalWifi4Bar from '@material-ui/icons/signalWifi4Bar';\nimport {SignalWifi4Bar,SignalWifi3Bar,SignalWifi2Bar,SignalWifi1Bar,SignalWifi0Bar} from '@material-ui/icons';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nimport mqtt from 'mqtt';\n\n  function ShowReconnectMessage(props){\n    const {target_ssid,open} = props;\n\n    return(\n    <Dialog fullScreen open={open}>\n      <h2>wifiへの接続を開始します</h2>\n      <ul>\n        <li>dishとの接続を切断します。</li>\n        <li>スマートフォンを{target_ssid}に接続してください。</li>\n        <li>３０秒後に自動的にcutleryを再読み込みします。</li>\n      </ul>\n    </Dialog>\n    );\n  }\n\n  function WifiStrengthIcon(props){\n    const {strength} = props;\n\n    if (strength>=4){\n      return <SignalWifi4Bar />\n    }else if(strength===3){\n      return <SignalWifi3Bar />\n    }else if(strength===2){\n      return <SignalWifi2Bar />\n    }else if(strength===1){\n        return <SignalWifi1Bar />\n    }else{\n      return <SignalWifi0Bar />\n    }\n  }\n\n  function PasswordDialog(props){\n    const { onClose, onSubmit, open, title } = props;\n    const [passwordText,setPassword] = useState(0);\n\n    function handleClose() {\n      onClose();\n    }\n\n    function submit(){\n      onSubmit(passwordText);\n    }\n\n    function onChange(event){\n      setPassword(event.target.value);\n    }\n  \n    return (\n      <Dialog onClose={handleClose} aria-labelledby=\"simple-dialog-title\" open={open}>\n        <DialogTitle id=\"simple-dialog-title\">{title}</DialogTitle>\n        <DialogContent>\n          <TextField\n            autoFocus\n            margin=\"dense\"\n            id=\"ssid_password\"\n            label=\"パスワードを入力\"\n            type=\"password\"\n            onChange={onChange}\n            fullWidth\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={submit} color=\"primary\">\n            接続\n          </Button>\n          <Button onClick={handleClose} color=\"default\">\n            戻る\n          </Button>\n        </DialogActions>\n      </Dialog>\n    );\n  }\n\n  function getUrl(){\n    var host_name=window.location.host.split(':')[0];\n    var url=\"ws://\"+host_name+\":9090\";\n    //console.log(url);\n    //url=\"ws://dishdev02.local:9090\";\n    url=\"ws://192.168.3.147:9090\";\n    //this.mqtt_client = mqtt.connect(url);\n    return url;\n  }\n\n\n  class WifiList extends React.Component{\n    constructor(props){\n      super(props);\n      this.state = {\n        ssid_list:[{id:\"test\",name:\"test\",strength:70}],\n        passwordDialogOpen:false,\n        reconnectDialogOpen:false,\n        passwordText:\"\",\n        selected_ssid:\"\",\n        switch_value: \"ap\"\n      };\n      this.mqtt_connect=null;\n      this.mqtt_client=null;\n    }\n\n    openPassword = (ssid) =>{\n      this.setState({passwordDialogOpen:true,\n      selected_ssid:ssid});\n    }\n\n    passwordClose = () => {\n      this.setState({passwordDialogOpen:false});\n    }\n\n    onPasswordSubmitted = (password) => {\n      this.setState({passwordText:password});\n      this.setState({reconnectDialogOpen:true});\n      var config_value={\"ssid\":this.state.selected_ssid,\"password\":password}\n\n      this.mqtt_client.publish('wifi_config/config',JSON.stringify(config_value));\n      this.passwordClose();\n    }\n\n    refresh_ssid_list = (topic,message) => {\n      //console.log(message.toString())\n      console.log(\"refreshing\");\n      var obj=JSON.parse(message.toString());\n      //this.setState({ssid_list:this.state.ssid_list.concat(obj)});\n      //this.setState({ssid_list:this.state.ssid_list = obj});\n      this.setState({ssid_list:obj});\n    }\n\n    connect_mqtt_server(){\n      var url=getUrl();\n      //console.log(url);\n      url=\"ws://dishdev02.local:9090\";\n      this.mqtt_client = mqtt.connect(url);\n      //#this.wireless_switch=mqtt.connect(url);\n\n      this.mqtt_client.on('connect',function(){\n        console.log(\"connected.\");\n      })\n\n      //this.mqtt_client.subscribe('wireless_switch/get_status',{qos:2});\n\n      this.mqtt_client.subscribe('wifi_config/scan_results',{qos:0});\n      this.mqtt_client.publish('process_waker/wake','wifi_config',{qos:2});\n      this.mqtt_client.on(\"message\",this.refresh_ssid_list);\n    }\n\n    render(){\n      return (\n        <div>\n          <h3>接続可能なWifiリスト</h3>\n          <List component=\"nav\">\n            {this.state.ssid_list.map(wifi => (\n              <ListItem key={wifi.id} onClick={() => this.openPassword(wifi.name)}>\n                <ListItemText primary={wifi.name.substr(0,20)} />\n                <WifiStrengthIcon strength={wifi.strength} />\n              </ListItem>\n            )\n            )}\n            {this.state.ssid_list.length < 1 && <ListItem key=\"0\">\n              <ListItemText primary=\"読込中\" />\n              <CircularProgress  />\n            </ListItem>}\n          </List>\n          <Divider />\n          <List component=\"nav\" aria-label=\"secondary mailbox folders\">\n            <ListItem button>\n              <ListItemText primary=\"その他\" />\n            </ListItem>\n          </List>\n                  {/* Password Dialog */}\n        <PasswordDialog title={this.state.selected_ssid.substr(0,20)} open={this.state.passwordDialogOpen} \n        onClose={this.passwordClose} onSubmit={this.onPasswordSubmitted}></PasswordDialog>\n        {/* Explain */ }\n        <ShowReconnectMessage open={this.state.reconnectDialogOpen} target_ssid={this.state.selected_ssid}/>\n        </div>\n    );\n    }\n  }\n\n  class WifiConfig extends React.Component {\n    constructor(props){\n      super(props);\n      this.state = {\n        ssid_list:[],\n        passwordDialogOpen:false,\n        reconnectDialogOpen:false,\n        passwordText:\"\",\n        selected_ssid:\"\",\n        switch_value: \"ap\"\n      };\n      this.mqtt_connect=null;\n      this.mqtt_client=null;\n    }\n\n    componentWillMount(){\n      //connect to MQTT\n      //alert(localtion.host);\n      //var host_name=window.location.host.split(':')[0];\n      //var url=\"ws://\"+host_name+\":9090\";\n    }\n\n    componentWillUnmount(){\n      //console.log(\"disconnecting...\");\n      //this.mqtt_client.end();\n    }\n\n    backToHome = () => {\n        this.props.history.push('/');\n    }\n\n    changeSwitchValue = (value) =>{\n      this.setState({switch_value:value});\n    }\n\n    render() {\n      return (\n        <div>\n          <h2>Wifi設定</h2>\n          {/* End hero unit */}\n              <h3>接続モード</h3>\n              <RadioGroup name=\"network-mode-selector\" value={this.state.switch_value}>\n                  <ListItem button onClick={() => this.changeSwitchValue(\"ap\")}>\n                    <FormControlLabel value=\"ap\" control={<Radio />}/>\n                    <ListItemText primary=\"APモード\" secondary='\"dish0010\"として接続出来ます' />\n                  </ListItem>\n                  <ListItem button onClick={() => this.changeSwitchValue(\"wifi\")}>\n                    <FormControlLabel value=\"wifi\" control={<Radio/>}/>\n                    <ListItemText primary=\"Wifiモード\" secondary=\"接続中：POMIQ24\"/>\n                  </ListItem>\n              </RadioGroup>\n              {this.state.switch_value===\"wifi\" ? <WifiList /> : ''}\n              <hr />\n              <Button variant=\"contained\" color=\"default\" onClick={this.backToHome}>戻る</Button>\n\n        </div>\n      );\n    }\n  }\n　　　　　　　　　　　　　　　　　　　　　　　　　　　　　\n  export default withRouter(WifiConfig);"]},"metadata":{},"sourceType":"module"}